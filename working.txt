[b'//init varibles with default values lets there are issues reading them from config\r\nlet global_brightness = 0.5\r\nlet global_whiteBalanceFactors = {\r\n    "red": 1.0,\r\n    "green": 0.8,\r\n    "blue": 0.6\r\n}\r\nlet global_gamma = 2.2\r\nconst brightnessScaler = 100;\r\n\r\n\r\nfunction setColorGlobals(shiftLightConfig) {\r\n    whiteBalance_factors = shiftLightConfig.whiteBalance_factors\r\n    gamma = shiftLightConfig.gamma\r\n    brightness = shiftLightConfig.brightness\r\n}\r\n\r\n// Helper function to convert RGB color to HEX\r\nf', b'unction rgbToHex(rgb) {\r\n    const result = rgb.match(/\\d+/g).map(Number);\r\n    return `#${((1 << 24) + (result[0] << 16) + (result[1] << 8) + result[2]).toString(16).slice(1).toUpperCase()}`;\r\n}\r\n\r\nfunction hexToRgb(hex) {\r\n    hex = hex.replace(/^#/, "");\r\n    let r = parseInt(hex.substring(0, 2), 16);\r\n    let g = parseInt(hex.substring(2, 4), 16);\r\n    let b = parseInt(hex.substring(4, 6), 16);\r\n    return { "red": r, "green": g, "blue": b };\r\n}\r\n\r\nfunction rgbToHsv(r, g, b) {\r\n    r /= 255, g /= 255, b', b' /= 255;\r\n    let max = Math.max(r, g, b), min = Math.min(r, g, b);\r\n    let h, s, v = max;\r\n    let d = max - min;\r\n    s = max === 0 ? 0 : d / max;\r\n\r\n    if (max === min) {\r\n        h = 0;\r\n    } else if (max === r) {\r\n        h = (60 * ((g - b) / d) + 360) % 360;\r\n    } else if (max === g) {\r\n        h = (60 * ((b - r) / d) + 120) % 360;\r\n    } else {\r\n        h = (60 * ((r - g) / d) + 240) % 360;\r\n    }\r\n\r\n    return { h, s, v };\r\n}\r\n\r\nfunction hsvToRgb(h, s, v) {\r\n    h = h % 360;\r\n    let c = v * s;\r', b'\n    let x = c * (1 - Math.abs((h / 60) % 2 - 1));\r\n    let m = v - c;\r\n    let r, g, b;\r\n\r\n    if (0 <= h && h < 60) {\r\n        r = c, g = x, b = 0;\r\n    } else if (60 <= h && h < 120) {\r\n        r = x, g = c, b = 0;\r\n    } else if (120 <= h && h < 180) {\r\n        r = 0, g = c, b = x;\r\n    } else if (180 <= h && h < 240) {\r\n        r = 0, g = x, b = c;\r\n    } else if (240 <= h && h < 300) {\r\n        r = x, g = 0, b = c;\r\n    } else {\r\n        r = c, g = 0, b = x;\r\n    }\r\n\r\n    return {\r\n        red: Math.r', b'ound((r + m) * 255),\r\n        green: Math.round((g + m) * 255),\r\n        blue: Math.round((b + m) * 255)\r\n    };\r\n}\r\n\r\nfunction rgbStringToObject(rgbString) {\r\n    const match = rgbString.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\r\n    if (!match) {\r\n        throw new Error("Invalid RGB string format: " + rgbString);\r\n    }\r\n    return {\r\n        red: parseInt(match[1]),\r\n        green: parseInt(match[2]),\r\n        blue: parseInt(match[3])\r\n    };\r\n}\r\n\r\nfunction applyColorAdjustments(color, brightness = glo', b'bal_brightness, gamma = global_gamma, colorFactors = global_whiteBalanceFactors) {\r\n    // Step 1: Apply brightness adjustment\r\n    let { h, s, v } = rgbToHsv(color.red, color.green, color.blue);\r\n    v *= brightness;\r\n    let adjustedColor = hsvToRgb(h, s, v);\r\n\r\n    // Step 2: Apply gamma correction\r\n    adjustedColor = {\r\n        red: Math.round(255 * Math.pow(adjustedColor.red / 255, gamma)),\r\n        green: Math.round(255 * Math.pow(adjustedColor.green / 255, gamma)),\r\n        blue: Math.round(255 * Ma', b'th.pow(adjustedColor.blue / 255, gamma))\r\n    };\r\n\r\n    // Step 3: Apply white balance adjustment\r\n    return {\r\n        red: Math.round(adjustedColor.red * colorFactors.red),\r\n        green: Math.round(adjustedColor.green * colorFactors.green),\r\n        blue: Math.round(adjustedColor.blue * colorFactors.blue)\r\n    };\r\n}\r\n\r\nfunction reverseColorAdjustments(color, brightness = global_brightness, gamma = global_gamma, colorFactors = global_whiteBalanceFactors) {\r\n    // Step 1: Reverse white balance adjustmen', b't\r\n    let corrected = {\r\n        red: color.red / colorFactors.red,\r\n        green: color.green / colorFactors.green,\r\n        blue: color.blue / colorFactors.blue\r\n    };\r\n\r\n    // Step 2: Reverse gamma correction\r\n    corrected = {\r\n        red: Math.pow(corrected.red / 255, 1 / gamma) * 255,\r\n        green: Math.pow(corrected.green / 255, 1 / gamma) * 255,\r\n        blue: Math.pow(corrected.blue / 255, 1 / gamma) * 255\r\n    };\r\n\r\n    // Step 3: Reverse brightness adjustment\r\n    let { h, s, v } = rgbToHs', b'v(corrected.red, corrected.green, corrected.blue);\r\n    v /= brightness;\r\n    return hsvToRgb(h, s, v);\r\n}\r\n', b'<!doctype html>\r\n<html lang="en">\r\n\r\n<head>\r\n    <meta charset="utf-8">\r\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\r\n    <meta name="description" content="A layout example with a side menu that hides on mobile, just like the Pure website.">\r\n    <title>Responsive Side Menu &ndash; Layout Examples &ndash; Pure</title>\r\n    <link rel="stylesheet" href="/webFiles/pure-min.css">\r\n    <link rel="stylesheet" href="/webFiles/styles.css">\r\n</head>\r\n<body>\r\n    <div id="layout">\r\n    ', b'    <!-- Menu toggle -->\r\n        <a href="#menu" id="menuLink" class="menu-link">\r\n            <!-- Hamburger icon -->\r\n            <span></span>\r\n        </a>\r\n\r\n        <div id="menu">\r\n            <div class="pure-menu">\r\n                <a class="pure-menu-heading" href="#company"><img src="/webFiles/resu-horiz-white.png" alt="Resu"\r\n                        style="width: 90%;"></a>\r\n\r\n                <ul class="pure-menu-list">\r\n                    <li class="pure-menu-item"><a href="#ShiftLights" clas', b's="pure-menu-link">Shift Lights</a></li>\r\n                    <li class="pure-menu-item"><a href="#about" class="pure-menu-link">About</a></li>\r\n\r\n                    <li class="pure-menu-item menu-item-divided pure-menu-selected">\r\n                        <a href="#" class="pure-menu-link">Services</a>\r\n                    </li>\r\n\r\n                    <li class="pure-menu-item"><a href="#contact" class="pure-menu-link">Contact</a></li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n\r\n        <', b'div id="main">\r\n            <div class="header">\r\n                <h1>Resu Control Unit Settings</h1>\r\n            </div>\r\n\r\n            <div class="content">\r\n                <div>\r\n                    <table>\r\n                        <tr>\r\n                            <td class="table-global-heading" colspan="2">\r\n                                <div class="heading-with-tooltip">\r\n                                    Shift Lights\r\n                                    <div class="tooltip">\r\n                  ', b'                      <img src="/webFiles/info-icon.png" alt="Info"\r\n                                            style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Settings for shift lights!</span>\r\n                                    </div>\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <th>\r\n                                <div class="hea', b'ding-with-tooltip">\r\n                                    Shift Light Pin\r\n                                    <div class="tooltip">\r\n                                        <img src="/webFiles/info-icon.png" alt="Info"\r\n                                            style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Select the pin you\'ve connected the shift light signal\r\n                                            wire too</span>\r\n                            ', b'        </div>\r\n                                </div>\r\n                            </th>\r\n                            <td>\r\n                                <select class="pinSelector-dropdown" data-endpoint="/config/Pins/Pins"\r\n                                    function-Name="ShiftLights" ,\r\n                                    allowed-class="O"><!--This is dynamically set by JS --></select>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                  ', b'          <th>\r\n                                <div class="heading-with-tooltip">\r\n                                    Light Color\r\n                                    <div class="tooltip">\r\n                                        <img src="/webFiles/info-icon.png" alt="Info"\r\n                                            style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Select the color of each of the 15 shift lights by\r\n                                  ', b'          clicking on the\r\n                                            corresponding light below. The color will update once you "click out" of the\r\n                                            color\r\n                                            picker.</span>\r\n                                    </div>\r\n                                </div>\r\n                            </th>\r\n                            <td>\r\n                                <div class="shiftColor-container" data-endpoint="/ShiftLights/Shift', b'Lights/colors"><!--This is dynamically set by JS--></div>\r\n                                <input type="color" id="colorPicker"\r\n                                    style="opacity: 0; position: absolute; pointer-events: none;"\r\n                                    onchange="changeColor(event)">\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <th>\r\n                                <div class="heading-with-tooltip">\r\n                  ', b'                  Rev Pattern\r\n                                    <div class="tooltip">\r\n                                        <img src="/webFiles/info-icon.png" alt="Info" style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Select the pattern used through the rev range</span>\r\n                                    </div>\r\n                                </div>\r\n                            </th>\r\n                            <td>\r\n                          ', b'      <div class="revPattern-containter" class="pure-button-group" role="group" data-endpoint="/ShiftLights/ShiftLights/pattern/selected"\r\n                                    aria-label="...">\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <th>\r\n                                <div class="heading-with-tooltip">\r\n                                    Limiter Color\r\n                             ', b'       <div class="tooltip">\r\n                                        <img src="/webFiles/info-icon.png" alt="Info" style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">\r\n                                            Select the color the shiftlights change to when the shift point is reached\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </th>\r\n   ', b'                         <td>\r\n                                <div class="limiterColor-container" data-endpoint="/ShiftLights/Limiter/colors"><!--This is dynamically set by JS --></div>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <th>\r\n                                <div class="heading-with-tooltip">\r\n                                    Limiter Pattern\r\n                                    <div class="tooltip">\r\n              ', b'                          <img src="/webFiles/info-icon.png" alt="Info" style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Select the pattern used when shift point is\r\n                                            reached</span>\r\n                                    </div>\r\n                                </div>\r\n                            </th>\r\n                            <td>\r\n                                <div class="limiterPattern-containter" class="p', b'ure-button-group" role="group" data-endpoint="/ShiftLights/Limiter/pattern/selected"\r\n                                    aria-label="...">\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <th>\r\n                                <div class="heading-with-tooltip">\r\n                                    Brightness\r\n                                    <div class="tooltip">\r\n                          ', b'              <img src="/webFiles/info-icon.png" alt="Info" style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Controls the Overall Brightness of the shift lights</span>\r\n                                    </div>\r\n                                </div>\r\n                            </th>\r\n                            <td>\r\n                                <div class="brightness-slider">\r\n                                    <input type="range" id="brightnessS', b'lider" min="0" max="100" value="50">\r\n                                    <input type="number" id="brightnessValue" min="0" max="100" value="50">\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                    </table>\r\n                    <div style="padding-top: 20px;"></div>\r\n                    <table>\r\n                        <tr>\r\n                            <td class="table-global-heading">\r\n                                <div class="hea', b'ding-with-tooltip">\r\n                                    Config Files\r\n                                    <div class="tooltip">\r\n                                        <img src="/webFiles/info-icon.png" alt="Info" style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Upload or Download config</span>\r\n                                    </div>\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n         ', b'               <tr>\r\n                            <td style="border-bottom-left-radius: 10px;">\r\n                                <div>\r\n                                    <div class="pure-g">\r\n                                        <div class="pure-u-1-2 center-button">\r\n                                            <button class="pure-button pure-button-primary" onclick="downloadConfig()">Download Current Config</button>\r\n                                        </div>\r\n                                      ', b'  <div class="pure-u-1-2 center-button">\r\n                                            <input type="file" id="fileInput" style="display: none;" onchange="uploadConfig(event)">\r\n                                            <button class="pure-button pure-button-primary" onclick="document.getElementById(\'fileInput\').click();">Upload Config</button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </td', b'>\r\n                        </tr>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \r\n    <script src="/webFiles/ui.js"></script>\r\n    <script src="/webFiles/colorUtils.js"></script>\r\n    <script src="/webFiles/ui-extended.js"></script>\r\n\r\n</body>\r\n\r\n</html>']
 vs (expected) 
[b'<!doctype html>\r\n<html lang="en">\r\n\r\n<head>\r\n    <meta charset="utf-8">\r\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\r\n    <meta name="description" content="A layout example with a side menu that hides on mobile, just like the Pure website.">\r\n    <title>Responsive Side Menu &ndash; Layout Examples &ndash; Pure</title>\r\n    <link rel="stylesheet" href="/webFiles/pure-min.css">\r\n    <link rel="stylesheet" href="/webFiles/styles.css">\r\n</head>\r\n<body>\r\n    <div id="layout">\r\n    ', b'    <!-- Menu toggle -->\r\n        <a href="#menu" id="menuLink" class="menu-link">\r\n            <!-- Hamburger icon -->\r\n            <span></span>\r\n        </a>\r\n\r\n        <div id="menu">\r\n            <div class="pure-menu">\r\n                <a class="pure-menu-heading" href="#company"><img src="/webFiles/resu-horiz-white.png" alt="Resu"\r\n                        style="width: 90%;"></a>\r\n\r\n                <ul class="pure-menu-list">\r\n                    <li class="pure-menu-item"><a href="#ShiftLights" clas', b's="pure-menu-link">Shift Lights</a></li>\r\n                    <li class="pure-menu-item"><a href="#about" class="pure-menu-link">About</a></li>\r\n\r\n                    <li class="pure-menu-item menu-item-divided pure-menu-selected">\r\n                        <a href="#" class="pure-menu-link">Services</a>\r\n                    </li>\r\n\r\n                    <li class="pure-menu-item"><a href="#contact" class="pure-menu-link">Contact</a></li>\r\n                </ul>\r\n            </div>\r\n        </div>\r\n\r\n        <', b'div id="main">\r\n            <div class="header">\r\n                <h1>Resu Control Unit Settings</h1>\r\n            </div>\r\n\r\n            <div class="content">\r\n                <div>\r\n                    <table>\r\n                        <tr>\r\n                            <td class="table-global-heading" colspan="2">\r\n                                <div class="heading-with-tooltip">\r\n                                    Shift Lights\r\n                                    <div class="tooltip">\r\n                  ', b'                      <img src="/webFiles/info-icon.png" alt="Info"\r\n                                            style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Settings for shift lights!</span>\r\n                                    </div>\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <th>\r\n                                <div class="hea', b'ding-with-tooltip">\r\n                                    Shift Light Pin\r\n                                    <div class="tooltip">\r\n                                        <img src="/webFiles/info-icon.png" alt="Info"\r\n                                            style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Select the pin you\'ve connected the shift light signal\r\n                                            wire too</span>\r\n                            ', b'        </div>\r\n                                </div>\r\n                            </th>\r\n                            <td>\r\n                                <select class="pinSelector-dropdown" data-endpoint="/config/Pins/Pins"\r\n                                    function-Name="ShiftLights" ,\r\n                                    allowed-class="O"><!--This is dynamically set by JS --></select>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                  ', b'          <th>\r\n                                <div class="heading-with-tooltip">\r\n                                    Light Color\r\n                                    <div class="tooltip">\r\n                                        <img src="/webFiles/info-icon.png" alt="Info"\r\n                                            style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Select the color of each of the 15 shift lights by\r\n                                  ', b'          clicking on the\r\n                                            corresponding light below. The color will update once you "click out" of the\r\n                                            color\r\n                                            picker.</span>\r\n                                    </div>\r\n                                </div>\r\n                            </th>\r\n                            <td>\r\n                                <div class="shiftColor-container" data-endpoint="/ShiftLights/Shift', b'Lights/colors"><!--This is dynamically set by JS--></div>\r\n                                <input type="color" id="colorPicker"\r\n                                    style="opacity: 0; position: absolute; pointer-events: none;"\r\n                                    onchange="changeColor(event)">\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <th>\r\n                                <div class="heading-with-tooltip">\r\n                  ', b'                  Rev Pattern\r\n                                    <div class="tooltip">\r\n                                        <img src="/webFiles/info-icon.png" alt="Info" style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Select the pattern used through the rev range</span>\r\n                                    </div>\r\n                                </div>\r\n                            </th>\r\n                            <td>\r\n                          ', b'      <div class="revPattern-containter" class="pure-button-group" role="group" data-endpoint="/ShiftLights/ShiftLights/pattern/selected"\r\n                                    aria-label="...">\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <th>\r\n                                <div class="heading-with-tooltip">\r\n                                    Limiter Color\r\n                             ', b'       <div class="tooltip">\r\n                                        <img src="/webFiles/info-icon.png" alt="Info" style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">\r\n                                            Select the color the shiftlights change to when the shift point is reached\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </th>\r\n   ', b'                         <td>\r\n                                <div class="limiterColor-container" data-endpoint="/ShiftLights/Limiter/colors"><!--This is dynamically set by JS --></div>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <th>\r\n                                <div class="heading-with-tooltip">\r\n                                    Limiter Pattern\r\n                                    <div class="tooltip">\r\n              ', b'                          <img src="/webFiles/info-icon.png" alt="Info" style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Select the pattern used when shift point is\r\n                                            reached</span>\r\n                                    </div>\r\n                                </div>\r\n                            </th>\r\n                            <td>\r\n                                <div class="limiterPattern-containter" class="p', b'ure-button-group" role="group" data-endpoint="/ShiftLights/Limiter/pattern/selected"\r\n                                    aria-label="...">\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                        <tr>\r\n                            <th>\r\n                                <div class="heading-with-tooltip">\r\n                                    Brightness\r\n                                    <div class="tooltip">\r\n                          ', b'              <img src="/webFiles/info-icon.png" alt="Info" style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Controls the Overall Brightness of the shift lights</span>\r\n                                    </div>\r\n                                </div>\r\n                            </th>\r\n                            <td>\r\n                                <div class="brightness-slider">\r\n                                    <input type="range" id="brightnessS', b'lider" min="0" max="100" value="50">\r\n                                    <input type="number" id="brightnessValue" min="0" max="100" value="50">\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n                    </table>\r\n                    <div style="padding-top: 20px;"></div>\r\n                    <table>\r\n                        <tr>\r\n                            <td class="table-global-heading">\r\n                                <div class="hea', b'ding-with-tooltip">\r\n                                    Config Files\r\n                                    <div class="tooltip">\r\n                                        <img src="/webFiles/info-icon.png" alt="Info" style="width: 20px; height: 20px;">\r\n                                        <span class="tooltiptext">Upload or Download config</span>\r\n                                    </div>\r\n                                </div>\r\n                            </td>\r\n                        </tr>\r\n         ', b'               <tr>\r\n                            <td style="border-bottom-left-radius: 10px;">\r\n                                <div>\r\n                                    <div class="pure-g">\r\n                                        <div class="pure-u-1-2 center-button">\r\n                                            <button class="pure-button pure-button-primary" onclick="downloadConfig()">Download Current Config</button>\r\n                                        </div>\r\n                                      ', b'  <div class="pure-u-1-2 center-button">\r\n                                            <input type="file" id="fileInput" style="display: none;" onchange="uploadConfig(event)">\r\n                                            <button class="pure-button pure-button-primary" onclick="document.getElementById(\'fileInput\').click();">Upload Config</button>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </td', b'>\r\n                        </tr>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \r\n    <script src="/webFiles/ui.js"></script>\r\n    <script src="/webFiles/colorUtils.js"></script>\r\n    <script src="/webFiles/ui-extended.js"></script>\r\n\r\n</body>\r\n\r\n</html>']